generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CUSTOMER
  DRIVER
  RESTAURANT
}

enum OrderStatus {
  PENDING // created by customer
  CONFIRMED // accepted by restaurant/admin
  ASSIGNED // driver assigned
  PICKED_UP
  DELIVERED
  CANCELED
}

enum PaymentMethod {
  CASH
  CARD
}

model User {
  id           String   @id @default(cuid())
  name         String
  email        String   @unique
  phone        String?  @unique
  passwordHash String
  role         Role     @default(CUSTOMER)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  addresses      Address[]
  orders         Order[]        @relation("CustomerOrders")
  driverProfile  DriverProfile?
  ordersAsDriver Order[]        @relation("DriverOrders") 
  restaurants    Restaurant[]   @relation("UserRestaurants") // ðŸ‘ˆ added
}

model Address {
  id        String   @id @default(cuid())
  userId    String
  label     String?
  line1     String
  city      String
  lat       Float
  lng       Float
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model Restaurant {
  id          String   @id @default(cuid())
  ownerId     String
  name        String
  description String?
  phone       String?  @unique
  email       String?  @unique
  logoUrl     String?
  bannerUrl   String?
  address     String?
  city        String?
  lat         Float?
  lng         Float?
  rating      Float?    @default(0.0)
  isOpen      Boolean   @default(true)
  openingTime String?
  closingTime String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  owner    User       @relation("UserRestaurants", fields: [ownerId], references: [id])
  menuItems MenuItem[]
  orders    Order[]
}

model MenuItem {
  id           String   @id @default(cuid())
  restaurantId String
  name         String
  description  String?
  price        Decimal  @db.Decimal(10, 2)
  imageUrl     String?  // menu item image
  isAvailable  Boolean  @default(true)
  createdAt    DateTime @default(now())

  restaurant Restaurant  @relation(fields: [restaurantId], references: [id])
  orderItems OrderItem[]

  @@index([restaurantId])
}


model Order {
  id              String        @id @default(cuid())
  customerId      String
  restaurantId    String
  driverId        String?
  status          OrderStatus   @default(PENDING)
  paymentMethod   PaymentMethod @default(CASH)
  total           Decimal       @db.Decimal(10, 2)
  addressSnapshot Json
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  customer   User        @relation("CustomerOrders", fields: [customerId], references: [id])
  restaurant Restaurant  @relation(fields: [restaurantId], references: [id])
  driver     User?       @relation("DriverOrders", fields: [driverId], references: [id]) // ðŸ‘ˆ
  items      OrderItem[]

  @@index([customerId])
  @@index([restaurantId])
  @@index([driverId])
  @@index([status])
}

model OrderItem {
  id         String  @id @default(cuid())
  orderId    String
  menuItemId String
  name       String
  price      Decimal @db.Decimal(10, 2)
  quantity   Int

  order    Order    @relation(fields: [orderId], references: [id])
  menuItem MenuItem @relation(fields: [menuItemId], references: [id])

  @@index([orderId])
  @@index([menuItemId]) // ðŸ‘ˆ added for performance
}

model DriverProfile {
  userId      String   @id
  vehicleType String?
  licenseNo   String?
  isAvailable Boolean  @default(false)
  currentLat  Float?
  currentLng  Float?
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}
